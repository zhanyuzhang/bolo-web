define(["three@78-0-x"],function(e,t,i){"use strict";var s=e("three@78-0-x"),r=function(){function e(e,i,s,r){var a=0;if(document.implementation&&document.implementation.createDocument){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState?0===n.status||200===n.status?n.response?(Ye=i,t(n.response,void 0,e)):r?r({type:"error",url:e}):console.error("ColladaLoader: Empty or non-existing file ("+e+")"):r?r({type:"error",url:e}):console.error("ColladaLoader: Couldn't load \""+e+'" ('+n.status+")"):3===n.readyState&&s&&(0===a&&(a=n.getResponseHeader("Content-Length")),s({total:a,loaded:n.responseText.length}))},n.open("GET",e,!0),n.send(null)}else alert("Don't know how to parse XML!")}function t(e,t,i){if(Re=(new DOMParser).parseFromString(e,"text/xml"),t=t||Ye,void 0!==i){var l=i.split("/");l.pop(),Ve=(l.length<1?".":l.join("/"))+"/"}r(),xe(),ze=a("library_images image",C,"image"),Ue=a("library_materials material",G,"material"),Pe=a("library_effects effect",$,"effect"),De=a("library_geometries geometry",R,"geometry"),Ge=a("library_cameras camera",re,"camera"),He=a("library_lights light",ne,"light"),Be=a("library_controllers controller",j,"controller"),Fe=a("library_animations animation",ee,"animation"),Ie=a("library_visual_scenes visual_scene",S,"visual_scene"),qe=a("library_kinematics_models kinematics_model",he,"kinematics_model"),Xe=[],Ee=[],je=n(),Le=new s.Group;for(var c=0;c<je.nodes.length;c++)Le.add(y(je.nodes[c]));Le.scale.multiplyScalar(Qe),h(),Me=o(),v();var d={scene:Le,morphs:Xe,skins:Ee,animations:Oe,kinematics:Se,dae:{images:ze,materials:Ue,cameras:Ge,lights:He,effects:Pe,geometries:De,controllers:Be,animations:Fe,visualScenes:Ie,visualScene:je,scene:je,kinematicsModels:qe,kinematicsModel:Me}};return t&&t(d),d}function i(e){Je=e}function r(){var e=Re.querySelectorAll("asset"),t=e[0];if(t&&t.childNodes)for(var i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];switch(s.nodeName){case"unit":var r=s.getAttribute("meter");r&&(Qe=parseFloat(r));break;case"up_axis":$e=s.textContent.charAt(0)}}}function a(e,t,i){for(var s=Re.querySelectorAll(e),r={},a=0,n=s.length,o=0;n>o;o++){var h=s[o],l=(new t).parse(h);l.id&&0!==l.id.length||(l.id=i+a++),r[l.id]=l}return r}function n(){var e=Re.querySelectorAll("scene instance_visual_scene")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return Ie[t.length>0?t:"visual_scene0"]}return null}function o(){var e=Re.querySelectorAll("instance_kinematics_model")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return qe[t.length>0?t:"kinematics_model0"]}return null}function h(){Oe=[],l(Le)}function l(e){var t=je.getChildById(e.colladaId,!0),i=null;if(t&&t.keys){i={fps:60,hierarchy:[{node:t,keys:t.keys,sids:t.sids}],node:e,name:"animation_"+e.name,length:0},Oe.push(i);for(var s=0,r=t.keys.length;r>s;s++)i.length=Math.max(i.length,t.keys[s].time)}else i={hierarchy:[{keys:[],sids:[]}]};for(var s=0,r=e.children.length;r>s;s++)for(var a=l(e.children[s]),n=0,o=a.hierarchy.length;o>n;n++)i.hierarchy.push({keys:[],sids:[]});return i}function c(){var e,t=1e6,i=-t,s=0;for(var r in Fe){var a=Fe[r];e=e||a.id;for(var n=0;n<a.sampler.length;n++){var o=a.sampler[n];o.create(),t=Math.min(t,o.startTime),i=Math.max(i,o.endTime),s=Math.max(s,o.input.length)}}return{start:t,end:i,frames:s,ID:e}}function d(e,t){var i=t instanceof V?Be[t.url]:t;if(!i||!i.morph)return void console.log("could not find morph controller!");for(var s=i.morph,r=0;r<s.targets.length;r++){var a=s.targets[r],n=De[a];if(n.mesh&&n.mesh.primitives&&n.mesh.primitives.length){var o=n.mesh.primitives[0].geometry;o.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:o.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}function u(e,t,i,r){if(e.world=e.world||new s.Matrix4,e.localworld=e.localworld||new s.Matrix4,e.world.copy(e.matrix),e.localworld.copy(e.matrix),e.channels&&e.channels.length){var a=e.channels[0],n=a.sampler.output[i];n instanceof s.Matrix4&&(e.world.copy(n),e.localworld.copy(n),0===i&&e.matrix.copy(n))}r&&e.world.multiplyMatrices(r,e.world),t.push(e);for(var o=0;o<e.nodes.length;o++)u(e.nodes[o],t,i,e.world)}function p(e,t){for(var i=0;i<e.length;i++){var r=e[i],a=-1;if("JOINT"==r.type){for(var n=0;n<t.joints.length;n++)if(r.sid===t.joints[n]){a=n;break}if(a>=0){var o=t.invBindMatrices[a];r.invBindMatrix=o,r.skinningMatrix=new s.Matrix4,r.skinningMatrix.multiplyMatrices(r.world,o),r.animatrix=new s.Matrix4,r.animatrix.copy(r.localworld),r.weights=[];for(var n=0;n<t.weights.length;n++)for(var h=0;h<t.weights[n].length;h++){var l=t.weights[n][h];l.joint===a&&r.weights.push(l)}}else console.warn("ColladaLoader: Could not find joint '"+r.sid+"'."),r.skinningMatrix=new s.Matrix4,r.weights=[]}}}function f(e){var t=[],i=function(e,t,r){var a={};a.name=t.sid,a.parent=e,a.matrix=t.matrix;var n=[new s.Vector3,new s.Quaternion,new s.Vector3];a.matrix.decompose(n[0],n[1],n[2]),a.pos=[n[0].x,n[0].y,n[0].z],a.scl=[n[2].x,n[2].y,n[2].z],a.rotq=[n[1].x,n[1].y,n[1].z,n[1].w],r.push(a);for(var o in t.nodes)i(t.sid,t.nodes[o],r)};return i(-1,e,t),t}function m(e,t,i){var r=[];u(t,r,-1),p(r,i.skin);for(var a=new s.Vector3,n=[],o=0;o<e.vertices.length;o++)n.push(new s.Vector3);for(o=0;o<r.length;o++)if("JOINT"==r[o].type)for(var h=0;h<r[o].weights.length;h++){var l=r[o].weights[h],c=l.index,d=l.weight,f=e.vertices[c],m=n[c];a.x=f.x,a.y=f.y,a.z=f.z,a.applyMatrix4(r[o].skinningMatrix),m.x+=a.x*d,m.y+=a.y*d,m.z+=a.z*d}for(var o=0;o<e.vertices.length;o++)e.vertices[o]=n[o]}function g(e,t,i){var r=Be[t.url];if(i=void 0!==i?i:40,!r||!r.skin)return void console.log("ColladaLoader: Could not find skin controller.");if(!t.skeleton||!t.skeleton.length)return void console.log("ColladaLoader: Could not find the skeleton for the skin. ");for(var a=c(),n=je.getChildById(t.skeleton[0],!0)||je.getChildBySid(t.skeleton[0],!0),o=f(n),h=r.skin.joints,l=[],d=0;d<h.length;d++)for(var g=0;g<o.length;g++)o[g].name===h[d]&&(l[d]=o[g]);for(var d=0;d<l.length;d++)for(var g=0;g<l.length;g++)l[d].parent===l[g].name&&(l[d].parent=g);var d,g,v;new s.Vector3;for(d=0;d<e.vertices.length;d++)e.vertices[d].applyMatrix4(r.skin.bindShapeMatrix);for(var y=[],b=[],w=r.skin.weights,d=0;d<w.length;d++){var x=new s.Vector4(w[d][0]?w[d][0].joint:0,w[d][1]?w[d][1].joint:0,w[d][2]?w[d][2].joint:0,w[d][3]?w[d][3].joint:0),v=new s.Vector4(w[d][0]?w[d][0].weight:0,w[d][1]?w[d][1].weight:0,w[d][2]?w[d][2].weight:0,w[d][3]?w[d][3].weight:0);y.push(x),b.push(v)}e.skinIndices=y,e.skinWeights=b,e.bones=l;for(var N={name:a.ID,fps:30,length:a.frames/30,hierarchy:[]},g=0;g<l.length;g++)N.hierarchy.push({parent:l[g].parent,name:l[g].name,keys:[]});for(console.log("ColladaLoader:",a.ID+" has "+l.length+" bones."),m(e,n,r),i=0;i<a.frames;i++){var k=[];u(n,k,i),p(k,r.skin);for(var d=0;d<k.length;d++)for(var g=0;g<N.hierarchy.length;g++)if(N.hierarchy[g].name===k[d].sid){var T={};T.time=i/30,T.matrix=k[d].animatrix,0===i&&(k[d].matrix=T.matrix);var _=[new s.Vector3,new s.Quaternion,new s.Vector3];T.matrix.decompose(_[0],_[1],_[2]),T.pos=[_[0].x,_[0].y,_[0].z],T.scl=[_[2].x,_[2].y,_[2].z],T.rot=_[1],N.hierarchy[g].keys.push(T)}e.animation=N}}function v(){if(Me&&0===Me.joints.length)return void(Se=void 0);var e={},t=function(t,i){var s=i.getAttribute("id"),r=je.getChildById(s,!0),a=Me.joints[t];Le.traverse(function(i){i.colladaId==s&&(e[t]={node:i,transforms:r.transforms,joint:a,position:a.zeroPosition})})};Se={joints:Me&&Me.joints,getJointValue:function(t){var i=e[t];return i?i.position:void console.log("getJointValue: joint "+t+" doesn't exist")},setJointValue:function(t,i){var a=e[t];if(a){var n=a.joint;if(i>n.limits.max||i<n.limits.min)console.log("setJointValue: joint "+t+" value "+i+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+")");else if(n["static"])console.log("setJointValue: joint "+t+" is static");else{var o=a.node,h=n.axis,l=a.transforms,c=new s.Matrix4;for(r=0;r<l.length;r++){var d=l[r];if(d.sid&&-1!==d.sid.indexOf("joint"+t))switch(n.type){case"revolute":c.multiply(u.makeRotationAxis(h,s.Math.degToRad(i)));break;case"prismatic":c.multiply(u.makeTranslation(h.x*i,h.y*i,h.z*i));break;default:console.warn("setJointValue: unknown joint type: "+n.type)}else{var u=new s.Matrix4;switch(d.type){case"matrix":c.multiply(d.obj);break;case"translate":c.multiply(u.makeTranslation(d.obj.x,d.obj.y,d.obj.z));break;case"rotate":c.multiply(u.makeRotationAxis(d.obj,d.angle))}}}var p=c.elements,f=Array.prototype.slice.call(p),m=[f[0],f[4],f[8],f[12],f[1],f[5],f[9],f[13],f[2],f[6],f[10],f[14],f[3],f[7],f[11],f[15]];o.matrix.set.apply(o.matrix,m),o.matrix.decompose(o.position,o.quaternion,o.scale)}}else console.log("setJointValue: joint "+t+" doesn't exist")}};var i=Re.querySelector("scene instance_kinematics_scene");if(i)for(var r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];if(1==a.nodeType)switch(a.nodeName){case"bind_joint_axis":var n=a.getAttribute("target").split("/").pop(),o=a.querySelector("axis param").textContent,h=parseInt(o.split("joint").pop().split(".")[0]),l=Re.querySelector('[sid="'+n+'"]');if(l){var c=l.parentElement;t(h,c)}}}}function y(e,t){var i,r,a,n,o=new s.Object3D,h=!1;for(a=0;a<e.controllers.length;a++){var l=Be[e.controllers[a].url];switch(l.type){case"skin":if(De[l.skin.source]){var c=new E;c.url=l.skin.source,c.instance_material=e.controllers[a].instance_material,e.geometries.push(c),h=!0,i=e.controllers[a]}else if(Be[l.skin.source]){var u=Be[l.skin.source];if(r=u,u.morph&&De[u.morph.source]){var c=new E;c.url=u.morph.source,c.instance_material=e.controllers[a].instance_material,e.geometries.push(c)}}break;case"morph":if(De[l.morph.source]){var c=new E;c.url=l.morph.source,c.instance_material=e.controllers[a].instance_material,e.geometries.push(c),r=e.controllers[a]}console.log("ColladaLoader: Morph-controller partially supported.")}}var p={};for(a=0;a<e.geometries.length;a++){var f,m=e.geometries[a],v=m.instance_material,b=De[m.url],w={},x=[],N=0;if(b){if(!b.mesh||!b.mesh.primitives)continue;if(0===o.name.length&&(o.name=b.id),v)for(n=0;n<v.length;n++){var k=v[n],T=Ue[k.target],_=T.instance_effect.url,A=Pe[_].shader,C=A.material;if(b.doubleSided){if(!(k.symbol in p)){var j=C.clone();j.side=s.DoubleSide,p[k.symbol]=j}C=p[k.symbol]}C.opacity=C.opacity?C.opacity:1,w[k.symbol]=N,x.push(C),f=C,f.name=null===T.name||""===T.name?T.id:T.name,N++}var M,O=f||new s.MeshLambertMaterial({color:14540253,side:b.doubleSided?s.DoubleSide:s.FrontSide}),S=b.mesh.geometry3js;if(N>1)for(O=new s.MultiMaterial(x),n=0;n<S.faces.length;n++){var I=S.faces[n];I.materialIndex=w[I.daeMaterial]}void 0!==i?(g(S,i),S.morphTargets.length>0?(O.morphTargets=!0,O.skinning=!1):(O.morphTargets=!1,O.skinning=!0),M=new s.SkinnedMesh(S,O,!1),M.name="skin_"+Ee.length,Ee.push(M)):void 0!==r?(d(S,r),O.morphTargets=!0,M=new s.Mesh(S,O),M.name="morph_"+Xe.length,Xe.push(M)):M=S.isLineStrip===!0?new s.Line(S):new s.Mesh(S,O),o.add(M)}}for(a=0;a<e.cameras.length;a++){var q=e.cameras[a],V=Ge[q.url],X=new s.PerspectiveCamera(V.yfov,parseFloat(V.aspect_ratio),parseFloat(V.znear),parseFloat(V.zfar));o.add(X)}for(a=0;a<e.lights.length;a++){var R=null,L=e.lights[a],Y=He[L.url];if(Y&&Y.technique){var Z=Y.color.getHex(),z=Y.intensity,F=Y.distance,B=Y.falloff_angle;switch(Y.technique){case"directional":R=new s.DirectionalLight(Z,z,F),R.position.set(0,0,1);break;case"point":R=new s.PointLight(Z,z,F);break;case"spot":R=new s.SpotLight(Z,z,F,B),R.position.set(0,0,1);break;case"ambient":R=new s.AmbientLight(Z)}}R&&o.add(R)}if(o.name=e.name||e.id||"",o.colladaId=e.id||"",o.layer=e.layer||"",o.matrix=e.matrix,o.matrix.decompose(o.position,o.quaternion,o.scale),We.centerGeometry&&o.geometry){var D=o.geometry.center();D.multiply(o.scale),D.applyQuaternion(o.quaternion),o.position.sub(D)}for(a=0;a<e.nodes.length;a++)o.add(y(e.nodes[a],e));return o}function b(e){for(var t=Re.querySelectorAll("library_nodes node"),i=0;i<t.length;i++){var s=t[i].attributes.getNamedItem("id");if(s&&s.value===e)return t[i]}return void 0}function w(e){var t=[],i=1e6,s=-1e6;for(var r in Fe)for(var a=Fe[r],n=0;n<a.channel.length;n++){var o=a.channel[n],h=a.sampler[n],r=o.target.split("/")[0];r==e.id&&(h.create(),o.sampler=h,i=Math.min(i,h.startTime),s=Math.max(s,h.endTime),t.push(o))}return t.length&&(e.startTime=i,e.endTime=s),t}function x(e){if(e.channels&&e.channels.length){for(var t=[],i=[],s=0,r=e.channels.length;r>s;s++){var a,n=e.channels[s],o=n.fullSid,h=n.sampler,l=h.input,c=e.getTransformBySid(n.sid);if(n.arrIndices){a=[];for(var d=0,u=n.arrIndices.length;u>d;d++)a[d]=Ae(n.arrIndices[d])}else a=Ce(n.member);if(c){-1===i.indexOf(o)&&i.push(o);for(var d=0,u=l.length;u>d;d++){var p=l[d],f=h.getData(c.type,d,a),m=N(t,p);if(!m){m=new se(p);var g=k(t,p);t.splice(-1===g?t.length:g,0,m)}m.addTarget(o,c,a,f)}}else console.log('Could not find transform "'+n.sid+'" in node '+e.id)}for(var s=0;s<i.length;s++)for(var v=i[s],d=0;d<t.length;d++){var m=t[d];m.hasTarget(v)||T(t,m,d,v)}e.keys=t,e.sids=i}}function N(e,t){for(var i=null,s=0,r=e.length;r>s&&null===i;s++){var a=e[s];if(a.time===t)i=a;else if(a.time>t)break}return i}function k(e,t){for(var i=-1,s=0,r=e.length;r>s&&-1===i;s++){var a=e[s];a.time>=t&&(i=s)}return i}function T(e,t,i,s){var r=A(e,s,i?i-1:0),a=_(e,s,i+1);if(r&&a){var n,o=(t.time-r.time)/(a.time-r.time),h=r.getTarget(s),l=a.getTarget(s).data,c=h.data;if("matrix"===h.type)n=c;else if(c.length){n=[];for(var d=0;d<c.length;++d)n[d]=c[d]+(l[d]-c[d])*o}else n=c+(l-c)*o;t.addTarget(s,h.transform,h.member,n)}}function _(e,t,i){for(;i<e.length;i++){var s=e[i];if(s.hasTarget(t))return s}return null}function A(e,t,i){for(i=i>=0?i:i+e.length;i>=0;i--){var s=e[i];if(s.hasTarget(t))return s}return null}function C(){this.id="",this.init_from=""}function j(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function M(){this.method=null,this.source=null,this.targets=null,this.weights=null}function O(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function S(){this.id="",this.name="",this.nodes=[],this.scene=new s.Group}function I(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new s.Matrix4}function q(){this.sid="",this.type="",this.data=[],this.obj=null}function V(){this.url="",this.skeleton=[],this.instance_material=[]}function X(){this.symbol="",this.target=""}function E(){this.url="",this.instance_material=[]}function R(){this.id="",this.mesh=null}function L(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function Y(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new s.Geometry}function Z(){Y.call(this),this.vcount=[]}function z(){Y.call(this),this.vcount=1}function F(){Y.call(this),this.vcount=3}function B(){this.source="",this.count=0,this.stride=0,this.params=[]}function D(){this.input={}}function U(){this.semantic="",this.offset=0,this.source="",this.set=0}function P(e){this.id=e,this.type=null}function G(){this.id="",this.name="",this.instance_effect=null}function H(){this.color=new s.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function J(e,t){this.type=e,this.effect=t,this.material=null}function W(e){this.effect=e,this.init_from=null,this.format=null}function Q(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function $(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function K(){this.url=""}function ee(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function te(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function ie(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function se(e){this.targets=[],this.time=e}function re(){this.id="",this.name="",this.technique=""}function ae(){this.url=""}function ne(){this.id="",this.name="",this.technique=""}function oe(){this.url=""}function he(){this.id="",this.name="",this.joints=[],this.links=[]}function le(){this.sid="",this.name="",this.axis=new s.Vector3,this.limits={min:0,max:0},this.type="",this["static"]=!1,this.zeroPosition=0,this.middlePosition=0}function ce(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function de(){this.joint="",this.transforms=[],this.links=[]}function ue(e){var t=e.getAttribute("id");return void 0!=Ze[t]?Ze[t]:(Ze[t]=new P(t).parse(e),Ze[t])}function pe(e){for(var t=ge(e),i=[],s=0,r=t.length;r>s;s++)i.push("true"===t[s]||"1"===t[s]?!0:!1);return i}function fe(e){for(var t=ge(e),i=[],s=0,r=t.length;r>s;s++)i.push(parseFloat(t[s]));return i}function me(e){for(var t=ge(e),i=[],s=0,r=t.length;r>s;s++)i.push(parseInt(t[s],10));return i}function ge(e){return e.length>0?ve(e).split(/\s+/):[]}function ve(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function ye(e,t,i){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):i}function be(e,t){var i=new s.ImageLoader;i.load(t,function(t){e.image=t,e.needsUpdate=!0})}function we(e,t){e.doubleSided=!1;var i=t.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0)}function xe(){if(We.convertUpAxis!==!0||$e===We.upAxis)Ke=null;else switch($e){case"X":Ke="Y"===We.upAxis?"XtoY":"XtoZ";break;case"Y":Ke="X"===We.upAxis?"YtoX":"YtoZ";break;case"Z":Ke="X"===We.upAxis?"ZtoX":"ZtoY"}}function Ne(e,t){if(We.convertUpAxis===!0&&$e!==We.upAxis)switch(Ke){case"XtoY":var i=e[0];e[0]=t*e[1],e[1]=i;break;case"XtoZ":var i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":var i=e[0];e[0]=e[1],e[1]=t*i;break;case"YtoZ":var i=e[1];e[1]=t*e[2],e[2]=i;break;case"ZtoX":var i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":var i=e[1];e[1]=e[2],e[2]=t*i}}function ke(e,t){if(We.convertUpAxis!==!0||$e===We.upAxis)return t;switch(e){case"X":t="XtoY"===Ke?-1*t:t;break;case"Y":t="YtoZ"===Ke||"YtoX"===Ke?-1*t:t;break;case"Z":t="ZtoY"===Ke?-1*t:t}return t}function Te(e,t){var i=[e[t],e[t+1],e[t+2]];return Ne(i,-1),new s.Vector3(i[0],i[1],i[2])}function _e(e){if(We.convertUpAxis){var t=[e[0],e[4],e[8]];Ne(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],t=[e[1],e[5],e[9]],Ne(t,-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],t=[e[2],e[6],e[10]],Ne(t,-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],t=[e[0],e[1],e[2]],Ne(t,-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],t=[e[4],e[5],e[6]],Ne(t,-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],t=[e[8],e[9],e[10]],Ne(t,-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],t=[e[3],e[7],e[11]],Ne(t,-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return(new s.Matrix4).set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ae(e){if(e>-1&&3>e){var t=["X","Y","Z"],i={X:0,Y:1,Z:2};e=Ce(t[e]),e=i[e]}return e}function Ce(e){if(We.convertUpAxis)switch(e){case"X":switch(Ke){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch(Ke){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch(Ke){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}var je,Me,Oe,Se,Ie,qe,Ve,Xe,Ee,Re=null,Le=null,Ye=null,Ze={},ze={},Fe={},Be={},De={},Ue={},Pe={},Ge={},He={},Je=s.SmoothShading,We={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},Qe=1,$e="Y",Ke=null;return C.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"init_from"===i.nodeName&&(this.init_from=i.textContent)}return this},j.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"skin":this.skin=(new O).parse(i),this.type=i.nodeName;break;case"morph":this.morph=(new M).parse(i),this.type=i.nodeName}}return this},M.prototype.parse=function(e){var t,i={},s=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"source":var a=(new P).parse(r);i[a.id]=a;break;case"targets":s=this.parseInputs(r);break;default:console.log(r.nodeName)}}for(t=0;t<s.length;t++){var n=s[t],a=i[n.source];switch(n.semantic){case"MORPH_TARGET":this.targets=a.read();break;case"MORPH_WEIGHT":this.weights=a.read()}}return this},M.prototype.parseInputs=function(e){for(var t=[],i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"input":t.push((new U).parse(s))}}return t},O.prototype.parse=function(e){var t,i,s={};this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1==a.nodeType)switch(a.nodeName){case"bind_shape_matrix":var n=fe(a.textContent);this.bindShapeMatrix=_e(n);break;case"source":var o=(new P).parse(a);s[o.id]=o;break;case"joints":t=a;break;case"vertex_weights":i=a;break;default:console.log(a.nodeName)}}return this.parseJoints(t,s),this.parseWeights(i,s),this},O.prototype.parseJoints=function(e,t){for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"input":var r=(new U).parse(s),a=t[r.source];"JOINT"===r.semantic?this.joints=a.read():"INV_BIND_MATRIX"===r.semantic&&(this.invBindMatrices=a.read())}}},O.prototype.parseWeights=function(e,t){for(var i,s,r=[],a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];if(1==n.nodeType)switch(n.nodeName){case"input":r.push((new U).parse(n));break;case"v":i=me(n.textContent);break;case"vcount":s=me(n.textContent)}}for(var o=0,a=0;a<s.length;a++){for(var h=s[a],l=[],c=0;h>c;c++){for(var d={},u=0;u<r.length;u++){var p=r[u],f=i[o+p.offset];switch(p.semantic){case"JOINT":d.joint=f;break;case"WEIGHT":d.weight=t[p.source].data[f]}}l.push(d),o+=r.length}for(var c=0;c<l.length;c++)l[c].index=a;this.weights.push(l)}},S.prototype.getChildById=function(e,t){for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildById(e,t);if(s)return s}return null},S.prototype.getChildBySid=function(e,t){for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildBySid(e,t);if(s)return s}return null},S.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new I).parse(i))}}return this},I.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var i,s,r=this.channels[t],a=r.target.split("/"),n=(a.shift(),a.shift()),o=n.indexOf(".")>=0,h=n.indexOf("(")>=0;if(o)a=n.split("."),n=a.shift(),s=a.shift();else if(h){i=n.split("("),n=i.shift();for(var l=0;l<i.length;l++)i[l]=parseInt(i[l].replace(/\)/,""))}if(n===e)return r.info={sid:n,dotSyntax:o,arrSyntax:h,arrIndices:i},r}return null},I.prototype.getChildById=function(e,t){if(this.id===e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildById(e,t);if(s)return s}return null},I.prototype.getChildBySid=function(e,t){if(this.sid===e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildBySid(e,t);if(s)return s}return null},I.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid===e)return this.transforms[t];return null},I.prototype.parse=function(e){var t;this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new s.Matrix4;for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new I).parse(r));break;case"instance_camera":this.cameras.push((new ae).parse(r));break;case"instance_controller":this.controllers.push((new V).parse(r));break;case"instance_geometry":this.geometries.push((new E).parse(r));break;case"instance_light":this.lights.push((new oe).parse(r));break;case"instance_node":t=r.getAttribute("url").replace(/^#/,"");var a=b(t);a&&this.nodes.push((new I).parse(a));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new q).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=w(this),x(this),this.updateMatrix(),this},I.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},q.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=fe(e.textContent),this.convert(),this},q.prototype.convert=function(){switch(this.type){case"matrix":this.obj=_e(this.data);break;case"rotate":this.angle=s.Math.degToRad(this.data[3]);case"translate":Ne(this.data,-1),this.obj=new s.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Ne(this.data,1),this.obj=new s.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},q.prototype.apply=function(){var e=new s.Matrix4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}}(),q.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var r="n"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=s.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=s.Math.degToRad(e[3])}}},V.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType)switch(i.nodeName){case"skeleton":this.skeleton.push(i.textContent.replace(/^#/,""));break;case"bind_material":for(var s=i.querySelectorAll("instance_material"),r=0;r<s.length;r++){var a=s[r];this.instance_material.push((new X).parse(a))}break;case"extra":}}return this},X.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},E.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"===i.nodeName){for(var s=i.querySelectorAll("instance_material"),r=0;r<s.length;r++){var a=s[r];this.instance_material.push((new X).parse(a))}break}}return this},R.prototype.parse=function(e){this.id=e.getAttribute("id"),we(this,e);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"mesh":this.mesh=new L(this).parse(i);break;case"extra":}}return this},L.prototype.parse=function(e){this.primitives=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":ue(i);break;case"vertices":this.vertices=(new D).parse(i);break;case"linestrips":this.primitives.push((new z).parse(i));break;case"triangles":this.primitives.push((new F).parse(i));break;case"polygons":this.primitives.push((new Y).parse(i));break;case"polylist":this.primitives.push((new Z).parse(i))}}if(this.geometry3js=new s.Geometry,null===this.vertices)return this;for(var r=Ze[this.vertices.input.POSITION.source].data,t=0;t<r.length;t+=3)this.geometry3js.vertices.push(Te(r,t).clone());for(var t=0;t<this.primitives.length;t++){var a=this.primitives[t];a.setVertices(this.vertices),this.handlePrimitive(a,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},L.prototype.handlePrimitive=function(e,t){if(e instanceof z)return void(t.isLineStrip=!0);var i,r,a,n,o,h,l,c=e.p,d=e.inputs,u=0,p=3,f=0,m=[];for(i=0;i<d.length;i++){a=d[i];var g=a.offset+1;switch(f=g>f?g:f,a.semantic){case"TEXCOORD":m.push(a.set)}}for(var v=0;v<c.length;++v)for(var y=c[v],b=0;b<y.length;){var w=[],x=[],N=null,k=[];for(p=e.vcount?e.vcount.length?e.vcount[u++]:e.vcount:y.length/f,i=0;p>i;i++)for(r=0;r<d.length;r++)switch(a=d[r],h=Ze[a.source],n=y[b+i*f+a.offset],l=h.accessor.params.length,o=n*l,a.semantic){case"VERTEX":w.push(n);break;case"NORMAL":x.push(Te(h.data,o));break;case"TEXCOORD":N=N||{},void 0===N[a.set]&&(N[a.set]=[]),N[a.set].push(new s.Vector2(h.data[o],h.data[o+1]));break;case"COLOR":k.push((new s.Color).setRGB(h.data[o],h.data[o+1],h.data[o+2]))}if(0===x.length)if(a=this.vertices.input.NORMAL){h=Ze[a.source],l=h.accessor.params.length;for(var T=0,_=w.length;_>T;T++)x.push(Te(h.data,w[T]*l))}else t.calcNormals=!0;if(!N&&(N={},a=this.vertices.input.TEXCOORD)){m.push(a.set),h=Ze[a.source],l=h.accessor.params.length;for(var T=0,_=w.length;_>T;T++)o=w[T]*l,void 0===N[a.set]&&(N[a.set]=[]),N[a.set].push(new s.Vector2(h.data[o],1-h.data[o+1]))}if(0===k.length&&(a=this.vertices.input.COLOR)){h=Ze[a.source],l=h.accessor.params.length;for(var T=0,_=w.length;_>T;T++)o=w[T]*l,k.push((new s.Color).setRGB(h.data[o],h.data[o+1],h.data[o+2]))}var A,C,j=null,M=[];if(3===p)M.push(new s.Face3(w[0],w[1],w[2],x,k.length?k:new s.Color));else if(4===p)M.push(new s.Face3(w[0],w[1],w[3],x.length?[x[0].clone(),x[1].clone(),x[3].clone()]:[],k.length?[k[0],k[1],k[3]]:new s.Color)),M.push(new s.Face3(w[1],w[2],w[3],x.length?[x[1].clone(),x[2].clone(),x[3].clone()]:[],k.length?[k[1],k[2],k[3]]:new s.Color));else if(p>4&&We.subdivideFaces){var O=k.length?k:new s.Color;for(r=1;p-1>r;)M.push(new s.Face3(w[0],w[r],w[r+1],x.length?[x[0].clone(),x[r++].clone(),x[r].clone()]:[],O))}if(M.length)for(var T=0,_=M.length;_>T;T++)for(j=M[T],j.daeMaterial=e.material,t.faces.push(j),r=0;r<m.length;r++)A=N[m[r]],C=p>4?[A[0],A[T+1],A[T+2]]:4===p?0===T?[A[0],A[1],A[3]]:[A[1].clone(),A[2],A[3].clone()]:[A[0],A[1],A[2]],void 0===t.faceVertexUvs[r]&&(t.faceVertexUvs[r]=[]),t.faceVertexUvs[r].push(C);else console.log("dropped face with vcount "+p+" for geometry with id: "+t.id);b+=f*p}},Y.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source===e.id&&(this.inputs[t].source=e.input.POSITION.source)},Y.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=ye(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"input":this.inputs.push((new U).parse(e.childNodes[t]));break;case"vcount":this.vcount=me(i.textContent);break;case"p":this.p.push(me(i.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},Z.prototype=Object.create(Y.prototype),
Z.prototype.constructor=Z,z.prototype=Object.create(Y.prototype),z.prototype.constructor=z,F.prototype=Object.create(Y.prototype),F.prototype.constructor=F,B.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=ye(e,"count",0),this.stride=ye(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("param"===i.nodeName){var s={};s.name=i.getAttribute("name"),s.type=i.getAttribute("type"),this.params.push(s)}}return this},D.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if("input"===e.childNodes[t].nodeName){var i=(new U).parse(e.childNodes[t]);this.input[i.semantic]=i}return this},U.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=ye(e,"set",-1),this.offset=ye(e,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},P.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"bool_array":this.data=pe(i.textContent),this.type=i.nodeName;break;case"float_array":this.data=fe(i.textContent),this.type=i.nodeName;break;case"int_array":this.data=me(i.textContent),this.type=i.nodeName;break;case"IDREF_array":case"Name_array":this.data=ge(i.textContent),this.type=i.nodeName;break;case"technique_common":for(var s=0;s<i.childNodes.length;s++)if("accessor"===i.childNodes[s].nodeName){this.accessor=(new B).parse(i.childNodes[s]);break}}}return this},P.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var s=this.data.slice(i,i+16),r=_e(s);e.push(r)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},G.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"===e.childNodes[t].nodeName){this.instance_effect=(new K).parse(e.childNodes[t]);break}return this},H.prototype.isColor=function(){return null===this.texture},H.prototype.isTexture=function(){return null!=this.texture},H.prototype.parse=function(e){"transparent"===e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var r=fe(i.textContent);this.color=new s.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},H.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1],e.childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?this.texOpts[i.nodeName]=1:this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},J.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new H).parse(i);break;case"bump":var s=i.getAttribute("bumptype");s?"heightfield"===s.toLowerCase()?this.bump=(new H).parse(i):"normalmap"===s.toLowerCase()?this.normal=(new H).parse(i):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+s+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new H).parse(i)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new H).parse(i));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var r=i.querySelectorAll("float");r.length>0&&(this[i.nodeName]=parseFloat(r[0].textContent))}}return this.create(),this},J.prototype.create=function(){var e={},t=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var i=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);i>0&&(t=!0,e.transparent=!0,e.opacity=1-i)}var r={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var a in this)switch(a){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var n=this[a];if(n instanceof H)if(n.isTexture()){var o=n.texture,h=this.effect.sampler[o];if(void 0!==h&&void 0!==h.source){var l=this.effect.surface[h.source];if(void 0!==l){var c=ze[l.init_from];if(c){var d,u=Ve+c.init_from,p=s.Loader.Handlers.get(u);null!==p?d=p.load(u):(d=new s.Texture,be(d,u)),d.wrapS=n.texOpts.wrapU?s.RepeatWrapping:s.ClampToEdgeWrapping,d.wrapT=n.texOpts.wrapV?s.RepeatWrapping:s.ClampToEdgeWrapping,d.offset.x=n.texOpts.offsetU,d.offset.y=n.texOpts.offsetV,d.repeat.x=n.texOpts.repeatU,d.repeat.y=n.texOpts.repeatV,e[r[a]]=d,"emission"===a&&(e.emissive=16777215)}}}}else"diffuse"!==a&&t||("emission"===a?e.emissive=n.color.getHex():e[a]=n.color.getHex());break;case"shininess":e[a]=this[a];break;case"reflectivity":e[a]=this[a],e[a]>0&&(e.envMap=We.defaultEnvMap),e.combine=s.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[a],1!==this[a]&&(e.envMap=We.defaultEnvMap);break;case"transparency":}switch(e.shading=Je,e.side=this.effect.doubleSided?s.DoubleSide:s.FrontSide,void 0!==e.diffuse&&(e.color=e.diffuse,delete e.diffuse),this.type){case"constant":void 0!=e.emissive&&(e.color=e.emissive),this.material=new s.MeshBasicMaterial(e);break;case"phong":case"blinn":this.material=new s.MeshPhongMaterial(e);break;case"lambert":default:this.material=new s.MeshLambertMaterial(e)}return this.material},W.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},Q.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},$.prototype.create=function(){return null===this.shader?null:void 0},$.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),we(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},$.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"surface":this.surface[t]=new W(this).parse(s);break;case"sampler2D":this.sampler[t]=new Q(this).parse(s);break;case"extra":break;default:console.log(s.nodeName)}}},$.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"profile_COMMON":this.parseProfileCOMMON(s);break;case"technique":t=s;break;case"newparam":this.parseNewparam(s);break;case"image":var r=(new C).parse(s);ze[r.id]=r;break;case"extra":break;default:console.log(s.nodeName)}}return t},$.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new J(i.nodeName,this).parse(i);break;case"extra":this.parseExtra(i)}}},$.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique":this.parseExtraTechnique(i)}}},$.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"bump":this.shader.parse(e)}}},K.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ee.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"animation":var s=(new ee).parse(i);for(var r in s.source)this.source[r]=s.source[r];for(var a=0;a<s.channel.length;a++)this.channel.push(s.channel[a]),this.sampler.push(s.sampler[a]);break;case"source":var r=(new P).parse(i);this.source[r.id]=r;break;case"sampler":this.sampler.push(new ie(this).parse(i));break;case"channel":this.channel.push(new te(this).parse(i))}}return this},te.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/"),i=(t.shift(),t.shift()),s=i.indexOf(".")>=0,r=i.indexOf("(")>=0;if(s)t=i.split("."),this.sid=t.shift(),this.member=t.shift();else if(r){var a=i.split("(");this.sid=a.shift();for(var n=0;n<a.length;n++)a[n]=parseInt(a[n].replace(/\)/,""));this.arrIndices=a}else this.sid=i;return this.fullSid=i,this.dotSyntax=s,this.arrSyntax=r,this},ie.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"input":this.inputs.push((new U).parse(i))}}return this},ie.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],i=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=i.read();break;case"OUTPUT":this.output=i.read(),this.strideOut=i.accessor.stride;break;case"INTERPOLATION":this.interpolation=i.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},ie.prototype.getData=function(e,t,i){var s;if("matrix"===e&&16===this.strideOut)s=this.output[t];else if(this.strideOut>1){s=[],t*=this.strideOut;for(var r=0;r<this.strideOut;++r)s[r]=this.output[t+r];if(3===this.strideOut)switch(e){case"rotate":case"translate":Ne(s,-1);break;case"scale":Ne(s,1)}else 4===this.strideOut&&"matrix"===e&&Ne(s,-1)}else s=this.output[t],i&&"translate"===e&&(s=ke(i,s));return s},se.prototype.addTarget=function(e,t,i,s){this.targets.push({sid:e,member:i,transform:t,data:s})},se.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var i=this.targets[t];e&&i.sid!==e||i.transform.update(i.data,i.member)}},se.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},se.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},se.prototype.interpolate=function(e,t){for(var i=0,s=this.targets.length;s>i;i++){var r,a=this.targets[i],n=e.getTarget(a.sid);if("matrix"!==a.transform.type&&n){var o=(t-this.time)/(e.time-this.time),h=n.data,l=a.data;if(0>o&&(o=0),o>1&&(o=1),l.length){r=[];for(var c=0;c<l.length;++c)r[c]=l[c]+(h[c]-l[c])*o}else r=l+(h-l)*o}else r=a.data;a.transform.update(r,a.member)}},re.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"optics":this.parseOptics(i)}}return this},re.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if("technique_common"===e.childNodes[t].nodeName)for(var i=e.childNodes[t],s=0;s<i.childNodes.length;s++)if(this.technique=i.childNodes[s].nodeName,"perspective"===this.technique)for(var r=i.childNodes[s],a=0;a<r.childNodes.length;a++){var n=r.childNodes[a];switch(n.nodeName){case"yfov":this.yfov=n.textContent;break;case"xfov":this.xfov=n.textContent;break;case"znear":this.znear=n.textContent;break;case"zfar":this.zfar=n.textContent;break;case"aspect_ratio":this.aspect_ratio=n.textContent}}else if("orthographic"===this.technique)for(var o=i.childNodes[s],a=0;a<o.childNodes.length;a++){var n=o.childNodes[a];switch(n.nodeName){case"xmag":this.xmag=n.textContent;break;case"ymag":this.ymag=n.textContent;break;case"znear":this.znear=n.textContent;break;case"zfar":this.zfar=n.textContent;break;case"aspect_ratio":this.aspect_ratio=n.textContent}}return this},ae.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ne.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},ne.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];switch(a.nodeName){case"color":var n=fe(a.textContent);this.color=new s.Color(0),this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"falloff_angle":this.falloff_angle=parseFloat(a.textContent);break;case"quadratic_attenuation":var o=parseFloat(a.textContent);this.distance=o?Math.sqrt(1/o):0}}}return this},ne.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},oe.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},he.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.joints=[],this.links=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i)}}return this},he.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(e.childNodes[t].nodeName){case"joint":this.joints.push((new le).parse(i));break;case"link":this.links.push((new ce).parse(i))}}return this},le.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.axis=new s.Vector3,this.limits={min:0,max:0},this.type="",this["static"]=!1,this.zeroPosition=0,this.middlePosition=0;var t=e.querySelector("axis"),i=fe(t.textContent);this.axis=Te(i,0);var r=e.querySelector("limits min")?parseFloat(e.querySelector("limits min").textContent):-360,a=e.querySelector("limits max")?parseFloat(e.querySelector("limits max").textContent):360;this.limits={min:r,max:a};for(var n=["prismatic","revolute"],o=0;o<n.length;o++){var h=n[o],l=e.querySelector(h);l&&(this.type=h)}return this.limits.min>=this.limits.max&&(this["static"]=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},ce.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.transforms=[],this.attachments=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"attachment_full":this.attachments.push((new de).parse(i));break;case"rotate":case"translate":case"matrix":this.transforms.push((new q).parse(i))}}return this},de.prototype.parse=function(e){this.joint=e.getAttribute("joint").split("/").pop(),this.links=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"link":this.links.push((new ce).parse(i));break;case"rotate":case"translate":case"matrix":this.transforms.push((new q).parse(i))}}return this},{load:e,parse:t,setPreferredShading:i,applySkin:g,geometries:De,options:We}};return r});