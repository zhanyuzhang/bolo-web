define(["three@78-0-x"],function(e,t,r){"use strict";var n=e("three@78-0-x"),i=function(e,t){function r(e){for(var r=0;r<e.length;r++){if("VRDisplay"in window&&e[r]instanceof VRDisplay){l=e[r],f=!1;break}if("HMDVRDevice"in window&&e[r]instanceof HMDVRDevice){l=e[r],f=!0;break}}void 0===l&&t&&t("HMD not available")}function i(){var t=v.isPresenting;if(v.isPresenting=void 0!==l&&(l.isPresenting||f&&document[x]instanceof window.HTMLElement),t!==v.isPresenting)if(v.isPresenting){p=e.getPixelRatio(),m=e.getSize();var r,n,i=l.getEyeParameters("left");f?(r=i.renderRect.width,n=i.renderRect.height):(r=i.renderWidth,n=i.renderHeight),e.setPixelRatio(1),e.setSize(2*r,n,!1)}else e.setPixelRatio(p),e.setSize(m.width,m.height)}function s(e){var t=2/(e.leftTan+e.rightTan),r=(e.leftTan-e.rightTan)*t*.5,n=2/(e.upTan+e.downTan),i=(e.upTan-e.downTan)*n*.5;return{scale:[t,n],offset:[r,i]}}function a(e,t,r,i){t=void 0===t?!0:t,r=void 0===r?.01:r,i=void 0===i?1e4:i;var a=t?-1:1,o=new n.Matrix4,l=o.elements,d=s(e);return l[0]=d.scale[0],l[1]=0,l[2]=d.offset[0]*a,l[3]=0,l[4]=0,l[5]=d.scale[1],l[6]=-d.offset[1]*a,l[7]=0,l[8]=0,l[9]=0,l[10]=i/(r-i)*-a,l[11]=i*r/(r-i),l[12]=0,l[13]=0,l[14]=a,l[15]=0,o.transpose(),o}function o(e,t,r,n){var i=Math.PI/180,s={upTan:Math.tan(e.upDegrees*i),downTan:Math.tan(e.downDegrees*i),leftTan:Math.tan(e.leftDegrees*i),rightTan:Math.tan(e.rightDegrees*i)};return a(s,t,r,n)}var l,d,c,h,u,f=!1,g=new n.Vector3,w=new n.Vector3;navigator.getVRDisplays?navigator.getVRDisplays().then(r):navigator.getVRDevices&&navigator.getVRDevices().then(r),this.isPresenting=!1,this.scale=1;var v=this,m=e.getSize(),p=e.getPixelRatio();this.setSize=function(t,r){if(m={width:t,height:r},v.isPresenting){var n=l.getEyeParameters("left");e.setPixelRatio(1),f?e.setSize(2*n.renderRect.width,n.renderRect.height,!1):e.setSize(2*n.renderWidth,n.renderHeight,!1)}else e.setPixelRatio(p),e.setSize(t,r)};var y,P,x,R=e.domElement;R.requestFullscreen?(y="requestFullscreen",x="fullscreenElement",P="exitFullscreen",document.addEventListener("fullscreenchange",i,!1)):R.mozRequestFullScreen?(y="mozRequestFullScreen",x="mozFullScreenElement",P="mozCancelFullScreen",document.addEventListener("mozfullscreenchange",i,!1)):(y="webkitRequestFullscreen",x="webkitFullscreenElement",P="webkitExitFullscreen",document.addEventListener("webkitfullscreenchange",i,!1)),window.addEventListener("vrdisplaypresentchange",i,!1),this.setFullScreen=function(e){return new Promise(function(t,r){return void 0===l?void r(new Error("No VR hardware found.")):v.isPresenting===e?void t():void(f?R[y]?(R[e?y:P]({vrDisplay:l}),t()):(console.error("No compatible requestFullscreen method found."),r(new Error("No compatible requestFullscreen method found."))):t(e?l.requestPresent([{source:R}]):l.exitPresent()))})},this.requestPresent=function(){return this.setFullScreen(!0)},this.exitPresent=function(){return this.setFullScreen(!1)};var S=new n.PerspectiveCamera;S.layers.enable(1);var E=new n.PerspectiveCamera;E.layers.enable(2),this.render=function(t,r){if(l&&v.isPresenting){var n=t.autoUpdate;n&&(t.updateMatrixWorld(),t.autoUpdate=!1);var i=l.getEyeParameters("left"),s=l.getEyeParameters("right");f?(g.copy(i.eyeTranslation),w.copy(s.eyeTranslation),h=i.recommendedFieldOfView,u=s.recommendedFieldOfView):(g.fromArray(i.offset),w.fromArray(s.offset),h=i.fieldOfView,u=s.fieldOfView),Array.isArray(t)&&(console.warn("THREE.VREffect.render() no longer supports arrays. Use object.layers instead."),t=t[0]);var a=e.getSize();d={x:0,y:0,width:a.width/2,height:a.height},c={x:a.width/2,y:0,width:a.width/2,height:a.height},e.setScissorTest(!0),e.clear(),null===r.parent&&r.updateMatrixWorld(),S.projectionMatrix=o(h,!0,r.near,r.far),E.projectionMatrix=o(u,!0,r.near,r.far),r.matrixWorld.decompose(S.position,S.quaternion,S.scale),r.matrixWorld.decompose(E.position,E.quaternion,E.scale);var m=this.scale;return S.translateOnAxis(g,m),E.translateOnAxis(w,m),e.setViewport(d.x,d.y,d.width,d.height),e.setScissor(d.x,d.y,d.width,d.height),e.render(t,S),e.setViewport(c.x,c.y,c.width,c.height),e.setScissor(c.x,c.y,c.width,c.height),e.render(t,E),e.setScissorTest(!1),n&&(t.autoUpdate=!0),void(f||l.submitFrame())}e.render(t,r)}};return i});